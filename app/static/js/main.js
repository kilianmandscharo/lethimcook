"use strict";const INPUTS=["title","description","duration","author","source","tags","ingredients","instructions"],RECIPE_NEW_KEY="recipe_new";function main(){attachMutationObserverToNotificationContainer()}function attachMutationObserverToNotificationContainer(){const t=document.getElementById("notification-container");if(!t)return;new MutationObserver((e,o)=>{for(const i of e)i.type==="childList"&&i.addedNodes.forEach(c=>{setTimeout(()=>{t.removeChild(c)},3e3)})}).observe(t,{childList:!0})}let state={};function injectLinkIntoTextarea(t,n){const{cursorPos:e,target:o,substitutionStart:i}=state;if(!e||!o||!i)return;const c=`[${t}](${window.location.origin}/recipe/${n})`,r=e+c.length;o.value=o.value.slice(0,i)+c+o.value.slice(state.cursorPos),o.selectionStart=o.selectionEnd=r-(e-i),state={}}function fetchLink(t){const n=t.selectionStart;if(t.value.length===0||t.value[n-1]!=="]")return;let o="",i=n-2;for(;i-- >0&&t.value[i]!=="[";)o+=t.value[i];const c=new URLSearchParams({query:o.split("").reverse().join("")});fetch(`${window.location.origin}/recipe/link?`+c.toString()).then(r=>r.text()).then(r=>{state.target=t,state.cursorPos=n,state.substitutionStart=i;try{const s=JSON.parse(r);injectLinkIntoTextarea(s.title,s.id)}catch{const a=document.createElement("div");a.id="select-dialog-container",a.style.top=a.getBoundingClientRect().top.toString(),a.innerHTML=r,document.body.appendChild(a),setTimeout(()=>{const d=()=>{var l;(l=document.getElementById("select-dialog-container"))===null||l===void 0||l.remove()},u=()=>{d(),document.removeEventListener("keydown",u)};document.addEventListener("keydown",u)},0)}}).catch(console.error)}function attachTextAreaKeyupEventListeners(){const t=document.getElementById("ingredients");t&&(t.addEventListener("keyup",e=>{e.key==="Enter"&&e.target&&insertStringInInputAtCursor(e.target,"- ")}),t.addEventListener("input",e=>{e.target&&fetchLink(e.target)}));const n=document.getElementById("instructions");n&&(n.addEventListener("keyup",e=>{if(e.key==="Enter"&&e.target){const o=getLastListNumberBeforeCursor(e.target);o&&insertStringInInputAtCursor(e.target,`${parseInt(o)+1}. `)}}),n.addEventListener("input",e=>{fetchLink(e.target)}))}function getLastListNumberBeforeCursor(t){const n=/(\n(\d+)|^(\d+))\./g,e=[...t.value.slice(0,t.selectionStart).matchAll(n)];return e.length>0?e[e.length-1][1]:null}function insertStringInInputAtCursor(t,n){const e=t.selectionStart,o=e+n.length;t.value=t.value.slice(0,e)+n+t.value.slice(t.selectionEnd),t.selectionStart=t.selectionEnd=o}function attachNewFormSubmitEventListener(){const t=document.getElementById("recipe-new-submit");t&&t.addEventListener("click",()=>{deleteFormFromLocalStorage()})}function attachFormEventListeners(){INPUTS.forEach(t=>{const n=document.getElementById(t);n&&n.addEventListener("blur",()=>{saveFormToLocalStorage()})})}function saveFormToLocalStorage(){const t=INPUTS.reduce((n,e)=>{var o;const i=document.getElementById(e);return n[e]=(o=i?.value)!==null&&o!==void 0?o:"",n},{});localStorage.setItem(RECIPE_NEW_KEY,JSON.stringify(t))}function loadFormFromLocalStorage(){const t=localStorage.getItem(RECIPE_NEW_KEY);if(!t)return;const n=JSON.parse(t);n&&INPUTS.forEach(e=>{var o;const i=document.getElementById(e);i&&(i.value=(o=n[e])!==null&&o!==void 0?o:"")})}function deleteFormFromLocalStorage(){localStorage.setItem(RECIPE_NEW_KEY,"")}function attachEventListenerToClipboardButton(){const t=document.getElementById("copy-url-to-clipboard-button");t&&t.addEventListener("click",()=>{const n=window.location.href;navigator.clipboard.writeText(n).then(()=>{notify("Link kopiert","success")}).catch(()=>{notify("Kopieren fehlgeschlagen","error")})})}function notify(t,n){const e=document.getElementById("notification-container");if(!e)return;const i=document.querySelectorAll(".notification").length,c=document.createElement("div");c.id=`notification-${i}`,c.className=n==="success"?"notification notification-success":"notification notification-danger";const r=document.createElement("div");r.className=n==="success"?"fa-solid fa-circle-info":"fa-regular fa-circle-exclamation";const s=document.createElement("p");s.className="notification-text",s.innerText=t,c.appendChild(r),c.appendChild(s),e.appendChild(c)}main();
